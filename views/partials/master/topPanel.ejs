<div id="preloader"></div>
<div class="row border-bottom hidden-print">
    <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0; z-index: 2011">

        <div class="navbar-header">

            <form role="form" class="form-inline">
                <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#">
                    <i class="fa fa-bars"></i>
                </a>

                <span class="projects">
                    <%
                        var currentProjectId = req.session.currentProjectId;
                    %>

                    <%
                        if (req.session.user) {
                    %>

                    <div class="form-group"><label for="projects" class="sr-only">Projects</label>
                        <select name="projects" id="projects" class="form-control projects" style="margin-top:13px; height:32px; font-size: 13px;" onchange="selectProject()">

                            <%  if (!req.session.projects || (req.session.projects && req.session.projects.length == 0)) {  %>
                                <option value="">Projects...</option>
                            <%  }  %>

                            <%  if (req.session.projects) {
                                    for (var p = 0; p < req.session.projects.length; p++) {
                            %>
                                        <%- '<option value="' + req.session.projects[p].id + '"' + (req.session.projects[p].id == currentProjectId ? ' selected' : '') + '>' +
                                            req.session.projects[p].name + '</option>'  %>
                            <%
                                    }
                                }
                            %>

                            <%  if (!req.session.user.isDemo) { %>
                                <option value="__add">Create new project...</option>
                            <% } %>
                        </select>
                    </div>
                    <%
                        }
                    %>
                </span>
            </form>
        </div>
        <ul class="nav navbar-top-links navbar-right hideAt600">
            <li>
                <h3 class="app-title">&nbsp;&nbsp;<%- application.branding.productName %></h3>
            </li>
            <li>
                <% if (req.session) { %>
                <a href="/logout">
                    <i class="fa fa-sign-out"></i> Log out
                </a>
                <% } else {%>
                <a href="/login">
                    <i class="fa fa-sign-in"></i> Log in
                </a>
                <% }%>
            </li>
        </ul>
    </nav>
</div>

<% if (req.session && req.session.user && req.session.user.isDemo) { %>
<div class="row hidden-print">
    <div class="alert alert-info alert-dismissable" style="margin-bottom: 0">
        <button aria-hidden="true" data-dismiss="alert" class="close" type="button"><span style="font-size:16px">x</span></button>
        You are logged into the <a href="/demo/features">demo account</a>.  When you're ready:
        &nbsp; <button onclick="window.location=('/register')" type="button" class="btn btn-info btn-xs">Signup for a free trial</button>
    </div>
</div>
<% } %>
<script>

//  a page can set this to a function that will be called upon the project being changed
var projectChanged;

    function apiHost() {
        return  '<%- settings.apiUrl %>/v1/analytics/';
    }

    function selectProject() {
        if ($('#projects').val() == '__add') {
            window.location = '/setup/projects/form';
        } else if ($('#projects').val()) {

            //  set default project
            $.get('/defaultproject/' + $('#projects').val(), function(data) {
                location.reload();
            });
        }
    }
</script>